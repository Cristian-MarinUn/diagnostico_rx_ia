{% extends 'core/base.html' %}
{% load static %}

{% block title %}Gesti√≥n de Permisos{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'users/css/dashboard.css' %}">
<style>
    .permissions-card {
        background: rgba(30, 41, 59, 0.7);
        border-radius: 1.5rem;
        padding: 2.5rem 2rem;
        box-shadow: 0 8px 32px rgba(0,0,0,0.18);
        max-width: 600px;
        margin: 0 auto;
        margin-top: 2rem;
    }
    .permissions-title {
        font-size: 2rem;
        font-weight: 800;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        letter-spacing: -0.02em;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .permissions-desc {
        color: var(--text-secondary);
        margin-bottom: 2rem;
    }
    .form-group label {
        color: var(--text-secondary);
        font-weight: 600;
        margin-bottom: 0.5rem;
    }
    .form-check {
        margin-bottom: 0.5rem;
    }
    .alert-info {
        background: rgba(102, 126, 234, 0.12);
        color: var(--primary-color);
        border-radius: 0.75rem;
        padding: 1rem 1.5rem;
        margin-top: 1.5rem;
        font-weight: 600;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-wrapper admin-dashboard">
    <div class="dashboard-container">
        <div class="permissions-card">
            <div class="permissions-title">Gesti√≥n de Permisos üîê</div>
            <div class="permissions-desc">Define qu√© acciones o m√≥dulos puede usar cada rol del sistema.</div>
            <form method="post">
                {% csrf_token %}
                <div class="form-group">
                    <label for="role">Selecciona un rol:</label>
                    <select name="role" id="role" class="form-control" onchange="this.form.submit()">
                        <option value="">-- Selecciona un rol --</option>
                        {% for rol in roles %}
                            <option value="{{ rol.id }}" {% if rol.id == selected_role_id %}selected{% endif %}>{{ rol.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                {% if permissions is not None %}
                <div class="form-group mt-3">
                    <label>Permisos disponibles:</label>
                    <div style="max-height: 220px; overflow-y: auto; border: 1px solid var(--glass-border); border-radius: 0.75rem; padding: 1rem; background: rgba(15,23,42,0.18);">
                        {% for perm in all_permissions %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="permissions" value="{{ perm.id }}" id="perm{{ perm.id }}" {% if perm.id in current_permissions %}checked{% endif %}>
                                <label class="form-check-label" for="perm{{ perm.id }}">{{ perm.name }}</label>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <button type="submit" class="btn btn-primary mt-3">Guardar cambios</button>
                {% endif %}
            </form>
            {% if message %}
                <div class="alert alert-info mt-3">{{ message }}</div>
            {% endif %}
            <a href="{% url 'users:admin_dashboard' %}" class="btn btn-secondary" style="margin-top: 2rem;">‚Üê Volver al Panel de Administraci√≥n</a>
        </div>
    </div>
</div>
{% endblock %}
