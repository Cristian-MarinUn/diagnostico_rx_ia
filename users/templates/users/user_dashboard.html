<!-- ================================ -->
<!-- ARCHIVO: users/templates/users/user_dashboard.html -->
<!-- ================================ -->
{% extends 'core/base.html' %}
{% load static %}

{% block title %}Dashboard - {{ user.get_full_name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'users/css/dashboard.css' %}">
<style>
    body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <div class="dashboard-container">
        
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <div class="dashboard-welcome">
                <div class="welcome-text">
                    <h1>¬°Bienvenido, {{ user.first_name }}! üëã</h1>
                    <p>Aqu√≠ tienes un resumen de tu actividad reciente</p>
                    <span class="user-role">
                        <span>üë®‚Äç‚öïÔ∏è</span>
                        <span>{{ user.get_rol_display }}</span>
                    </span>
                </div>
                <div class="dashboard-actions">
                    {% if user.rol == 'MEDICO_RADIOLOGO' %}
                        <a href="{% url 'diagnostico:request_diagnosis_select' %}" class="btn btn-primary">
                            <span>üìä</span>
                            <span>Nuevo Diagn√≥stico</span>
                        </a>
                    {% elif user.rol == 'TECNICO_SALUD' %}
                        <a href="{% url 'diagnostico:request_diagnosis_select' %}" class="btn btn-primary">
                            <span>üì§</span>
                            <span>Cargar Im√°genes</span>
                        </a>
                    {% endif %}
                    <a href="{% url 'users:profile' %}" class="btn btn-outline">
                        <span>‚öôÔ∏è</span>
                        <span>Mi Perfil</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon primary">
                    <span>üìÅ</span>
                </div>
                <div class="stat-content">
                    <div class="stat-label">Total Estudios</div>
                    <div class="stat-value">{{ total_estudios|default:0 }}</div>
                    <div class="stat-change positive">
                        <span class="arrow">‚Üó</span>
                        <span>+12% este mes</span>
                    </div>
                </div>
            </div>

            {% if user.rol == 'MEDICO_RADIOLOGO' %}
            <div class="stat-card">
                <div class="stat-icon success">
                    <span>‚úÖ</span>
                </div>
                <div class="stat-content">
                    <div class="stat-label">Diagn√≥sticos</div>
                    <div class="stat-value">{{ total_diagnosticos|default:0 }}</div>
                    <div class="stat-change positive">
                        <span class="arrow">‚Üó</span>
                        <span>+8% esta semana</span>
                    </div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon warning">
                    <span>‚è≥</span>
                </div>
                <div class="stat-content">
                    <div class="stat-label">Pendientes</div>
                    <div class="stat-value">{{ pendientes|default:0 }}</div>
                    <div class="stat-change negative">
                        <span class="arrow">‚Üò</span>
                        <span>3 para hoy</span>
                    </div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon info">
                    <span>üìà</span>
                </div>
                <div class="stat-content">
                    <div class="stat-label">Precisi√≥n IA</div>
                    <div class="stat-value">{{ precision_ia|default:"94.2" }}%</div>
                    <div class="stat-change positive">
                        <span class="arrow">‚Üó</span>
                        <span>+2.1% mejora</span>
                    </div>
                </div>
            </div>
            {% elif user.rol == 'TECNICO_SALUD' %}
            <div class="stat-card">
                <div class="stat-icon success">
                    <span>üì§</span>
                </div>
                <div class="stat-content">
                    <div class="stat-label">Im√°genes Cargadas</div>
                    <div class="stat-value">{{ imagenes_cargadas|default:0 }}</div>
                    <div class="stat-change positive">
                        <span class="arrow">‚Üó</span>
                        <span>+15% este mes</span>
                    </div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon warning">
                    <span>‚öôÔ∏è</span>
                </div>
                <div class="stat-content">
                    <div class="stat-label">En Proceso</div>
                    <div class="stat-value">{{ en_proceso|default:0 }}</div>
                    <div class="stat-change">
                        <span>Analizando</span>
                    </div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon info">
                    <span>‚úÖ</span>
                </div>
                <div class="stat-content">
                    <div class="stat-label">Completados</div>
                    <div class="stat-value">{{ completados|default:0 }}</div>
                    <div class="stat-change positive">
                        <span class="arrow">‚Üó</span>
                        <span>Hoy</span>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Quick Actions -->
        <section class="quick-actions-section">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="section-title-icon">‚ö°</span>
                    <span>Acciones R√°pidas</span>
                </h2>
            </div>

            <div class="actions-grid">
                {% if user.rol == 'MEDICO_RADIOLOGO' %}
                <a href="{% url 'users:request_diagnosis_ia' %}" class="action-card" target="_blank" rel="noopener noreferrer">
                    <div class="action-icon">
                        <span>ü§ñ</span>
                    </div>
                    <h3 class="action-title">Diagn√≥stico Asistido por IA</h3>
                    <p class="action-description">
                        Obt√©n un diagn√≥stico preliminar asistido por IA en segundos
                    </p>
                </a>

                <a href="{% url 'users:search_patient' %}" class="action-card">
                    <div class="action-icon">
                        <span>üîç</span>
                    </div>
                    <h3 class="action-title">Buscar Paciente</h3>
                    <p class="action-description">
                        Encuentra y consulta informaci√≥n de pacientes por nombre o documento
                    </p>
                </a>

                <a href="{% url 'users:diagnosis_history' %}" class="action-card">
                    <div class="action-icon">
                        <span>üìã</span>
                    </div>
                    <h3 class="action-title">Historial de Diagn√≥sticos</h3>
                    <p class="action-description">
                        Consulta el historial de diagn√≥sticos por paciente y revisa detalles
                    </p>
                </a>

                <a href="{% url 'users:compare_studies' %}" class="action-card">
                    <div class="action-icon">
                        <span>üîÑ</span>
                    </div>
                    <h3 class="action-title">Comparar Estudios</h3>
                    <p class="action-description">
                        Compara im√°genes con casos anteriores del paciente
                    </p>
                </a>

                <a href="{% url 'users:patient_create' %}" class="action-card">
                    <div class="action-icon">
                        <span>‚ûï</span>
                    </div>
                    <h3 class="action-title">Agregar Paciente</h3>
                    <p class="action-description">
                        Registra un nuevo paciente en el sistema
                    </p>
                </a>
                {% elif user.rol == 'TECNICO_SALUD' %}
                <a href="{% url 'diagnostico:request_diagnosis_select' %}" class="action-card">
                    <div class="action-icon">
                        <span>üì§</span>
                    </div>
                    <h3 class="action-title">Cargar Im√°genes</h3>
                    <p class="action-description">
                        Sube nuevas im√°genes m√©dicas al sistema
                    </p>
                </a>

                <a href="{% url 'diagnostico:request_diagnosis_select' %}" class="action-card">
                    <div class="action-icon">
                        <span>ü§ñ</span>
                    </div>
                    <h3 class="action-title">Solicitar Diagn√≥stico</h3>
                    <p class="action-description">
                        Solicita un an√°lisis de IA para las im√°genes cargadas
                    </p>
                </a>

                <a href="{% url 'diagnostico:diagnosis_list' %}" class="action-card">
                    <div class="action-icon">
                        <span>üìä</span>
                    </div>
                    <h3 class="action-title">Ver Diagn√≥sticos</h3>
                    <p class="action-description">
                        Revisa los diagn√≥sticos solicitados y completados
                    </p>
                </a>

                <a href="{% url 'users:patient_create' %}" class="action-card">
                    <div class="action-icon">
                        <span>‚ûï</span>
                    </div>
                    <h3 class="action-title">Agregar Paciente</h3>
                    <p class="action-description">
                        Registra un nuevo paciente en el sistema
                    </p>
                </a>
                {% endif %}
            </div>
        </section>

        <!-- Recent Activity -->
        <section class="recent-activity-section">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="section-title-icon">üïí</span>
                    <span>Actividad Reciente</span>
                </h2>
                <a href="#" class="section-link">
                    <span>Ver historial completo</span>
                    <span>‚Üí</span>
                </a>
            </div>

            <div class="activity-container">
                {% if recent_activities %}
                <div class="activity-list">
                    {% for activity in recent_activities %}
                    <div class="activity-item">
                        <div class="activity-icon {{ activity.type }}">
                            <span>{{ activity.icon }}</span>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">{{ activity.title }}</div>
                            <div class="activity-description">{{ activity.description }}</div>
                            <div class="activity-meta">
                                <span class="activity-time">
                                    <span>üïê</span>
                                    <span>{{ activity.time }}</span>
                                </span>
                                <span class="activity-badge badge-{{ activity.status }}">
                                    {{ activity.status_text }}
                                </span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">üì≠</div>
                    <h3 class="empty-state-title">No hay actividad reciente</h3>
                    <p class="empty-state-description">
                        Cuando realices acciones en el sistema, aparecer√°n aqu√≠
                    </p>
                    {% if user.rol == 'MEDICO_RADIOLOGO' %}
                    <a href="#" class="btn btn-primary">
                        Solicitar Diagn√≥stico
                    </a>
                    {% elif user.rol == 'TECNICO_SALUD' %}
                    <a href="{% url 'diagnostico:request_diagnosis_select' %}" class="btn btn-primary">
                        Cargar Im√°genes
                    </a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </section>

    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'users/js/dashboard.js' %}"></script>
{% endblock %}