{% extends 'core/base.html' %}
{% load static %}

{% block title %}Reportes Estad√≠sticos{% endblock %}


{% block extra_css %}
<link rel="stylesheet" href="{% static 'users/css/dashboard.css' %}">
<style>
    .reports-card {
        background: rgba(30, 41, 59, 0.7);
        border-radius: 1.5rem;
        padding: 2.5rem 2rem;
        box-shadow: 0 8px 32px rgba(0,0,0,0.18);
        max-width: 700px;
        margin: 0 auto;
        margin-top: 2rem;
    }
    .reports-title {
        font-size: 2rem;
        font-weight: 800;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        letter-spacing: -0.02em;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .reports-desc {
        color: var(--text-secondary);
        margin-bottom: 2rem;
    }
    .report-type-form {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
    }
    .report-type-form label {
        color: var(--text-secondary);
        font-weight: 600;
    }
    .report-type-form select {
        min-width: 180px;
    }
    .report-content {
        margin-top: 1.5rem;
    }
    .table {
        width: 100%;
        background: rgba(15,23,42,0.18);
        border-radius: 0.75rem;
        overflow: hidden;
        margin-bottom: 1.5rem;
    }
    .table th, .table td {
        padding: 0.75rem 1.25rem;
        text-align: left;
        color: var(--text-primary);
    }
    .table th {
        background: rgba(102, 126, 234, 0.12);
        font-weight: 700;
        text-transform: uppercase;
        font-size: 0.95rem;
    }
    .table tr:nth-child(even) td {
        background: rgba(30,41,59,0.12);
    }
    .alert-warning {
        background: rgba(245, 158, 11, 0.12);
        color: #f59e0b;
        border-radius: 0.75rem;
        padding: 1rem 1.5rem;
        font-weight: 600;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <div class="dashboard-container">
        <div class="reports-card">
            <div class="reports-title">üìä Reportes Estad√≠sticos</div>
            <div class="reports-desc">Visualiza y exporta informaci√≥n clave sobre el sistema y su uso.</div>
            <form method="get" class="report-type-form">
                <label for="report_type">Tipo de reporte:</label>
                <select name="report_type" id="report_type">
                    <option value="precision" {% if report_type == 'precision' %}selected{% endif %}>Precisi√≥n del sistema</option>
                    <option value="diagnosticos" {% if report_type == 'diagnosticos' %}selected{% endif %}>Diagn√≥sticos realizados</option>
                    <option value="uso" {% if report_type == 'uso' %}selected{% endif %}>Uso de m√≥dulos</option>
                </select>
                <button type="submit" class="btn btn-primary">Generar</button>
            </form>

            {% if no_data %}
                <div class="alert alert-warning" style="margin-top:20px;">
                    No existen datos suficientes para generar el reporte.
                </div>
            {% else %}
                <div class="report-content">
                    {% if report_type == 'precision' %}
                        <h3 style="color: var(--primary-light); font-weight: 700; margin-bottom: 1rem;">Precisi√≥n del sistema</h3>
                        <table class="table">
                            <thead>
                                <tr><th>Fecha</th><th>Precisi√≥n (%)</th></tr>
                            </thead>
                            <tbody>
                                {% for row in report_data %}
                                    <tr><td>{{ row.fecha }}</td><td>{{ row.precision }}</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% elif report_type == 'diagnosticos' %}
                        <h3 style="color: var(--secondary-light); font-weight: 700; margin-bottom: 1rem;">Diagn√≥sticos realizados</h3>
                        <table class="table">
                            <thead>
                                <tr><th>Fecha</th><th>Cantidad</th></tr>
                            </thead>
                            <tbody>
                                {% for row in report_data %}
                                    <tr><td>{{ row.fecha }}</td><td>{{ row.cantidad }}</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% elif report_type == 'uso' %}
                        <h3 style="color: #60a5fa; font-weight: 700; margin-bottom: 1rem;">Uso de m√≥dulos</h3>
                        <table class="table">
                            <thead>
                                <tr><th>M√≥dulo</th><th>Uso</th></tr>
                            </thead>
                            <tbody>
                                {% for row in report_data %}
                                    <tr><td>{{ row.modulo }}</td><td>{{ row.uso }}</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% endif %}
                    <form method="post" style="margin-top:20px; display: flex; gap: 1rem;">
                        {% csrf_token %}
                        <button type="submit" name="export" value="pdf" class="btn btn-secondary">Exportar a PDF</button>
                        <button type="submit" name="export" value="excel" class="btn btn-secondary">Exportar a Excel</button>
                    </form>
                </div>
            {% endif %}
            <a href="{% url 'users:admin_dashboard' %}" class="btn btn-secondary" style="margin-top: 2rem;">‚Üê Volver al Panel de Administraci√≥n</a>
        </div>
    </div>
</div>
{% endblock %}
